<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        input[type="file"] {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .preview {
            margin-top: 20px;
            text-align: center;
        }
        .preview img {
            max-width: 100%;
            max-height: 400px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</h1>
        
        <div class="test-section">
            <h3>1. Ø±ÙØ¹ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…</h3>
            <input type="file" id="generalCertificate" accept="image/*">
            <button onclick="uploadGeneralCertificate()" id="uploadGeneralBtn">Ø±ÙØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</button>
            <div id="general-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>2. Ø±ÙØ¹ Ù‚Ø§Ù„Ø¨ Ø´Ù‡Ø§Ø¯Ø© Ù„Ù‡Ø§ÙƒØ§Ø«ÙˆÙ† Ù…Ø­Ø¯Ø¯</h3>
            <input type="text" id="hackathonId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ù‡Ø§ÙƒØ§Ø«ÙˆÙ†" value="cm4h9qtwl00097p1e5asju4sv">
            <input type="file" id="hackathonCertificate" accept="image/*">
            <button onclick="uploadHackathonCertificate()" id="uploadHackathonBtn">Ø±ÙØ¹ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù‡Ø§ÙƒØ§Ø«ÙˆÙ†</button>
            <div id="hackathon-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>3. Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h3>
            <button onclick="previewCertificate()">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
            <div class="preview" id="preview-section"></div>
        </div>

        <div class="test-section">
            <h3>4. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</h3>
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" value="admin@hackathon.com">
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="admin123">
            <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <div id="login-result" class="result"></div>
        </div>
    </div>

    <script>
        const baseUrl = 'http://localhost:3001';
        let authToken = null;

        async function login() {
            const resultDiv = document.getElementById('login-result');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            resultDiv.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
            
            try {
                const response = await fetch(`${baseUrl}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!\nØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${data.user?.name}\nØ§Ù„Ø¯ÙˆØ±: ${data.user?.role}`;
                    authToken = data.token;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!\nØ§Ù„Ø®Ø·Ø£: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `ğŸ’¥ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©: ${error.message}`;
            }
        }

        async function uploadGeneralCertificate() {
            const resultDiv = document.getElementById('general-result');
            const fileInput = document.getElementById('generalCertificate');
            const file = fileInput.files[0];
            
            if (!file) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹';
                return;
            }
            
            resultDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©...';
            const uploadBtn = document.getElementById('uploadGeneralBtn');
            uploadBtn.disabled = true;
            
            try {
                const formData = new FormData();
                formData.append('certificateImage', file);
                
                const response = await fetch(`${baseUrl}/api/admin/certificate-template`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!\nØ§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ${data.fileName}\nØ§Ù„Ù…Ø³Ø§Ø±: ${data.filePath}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©!\nØ§Ù„Ø®Ø·Ø£: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `ğŸ’¥ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©: ${error.message}`;
            } finally {
                uploadBtn.disabled = false;
            }
        }

        async function uploadHackathonCertificate() {
            const resultDiv = document.getElementById('hackathon-result');
            const fileInput = document.getElementById('hackathonCertificate');
            const hackathonId = document.getElementById('hackathonId').value;
            const file = fileInput.files[0];
            
            if (!file) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹';
                return;
            }
            
            if (!hackathonId) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù‡Ø§ÙƒØ§Ø«ÙˆÙ†';
                return;
            }
            
            resultDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù‡Ø§ÙƒØ§Ø«ÙˆÙ†...';
            const uploadBtn = document.getElementById('uploadHackathonBtn');
            uploadBtn.disabled = true;
            
            try {
                const formData = new FormData();
                formData.append('certificateTemplate', file);
                
                const response = await fetch(`${baseUrl}/api/admin/hackathons/${hackathonId}/certificate-template`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… ØªÙ… Ø±ÙØ¹ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù‡Ø§ÙƒØ§Ø«ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­!\nØ§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ${data.fileName}\nØ§Ù„Ù…Ø³Ø§Ø±: ${data.filePath}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©!\nØ§Ù„Ø®Ø·Ø£: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `ğŸ’¥ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©: ${error.message}`;
            } finally {
                uploadBtn.disabled = false;
            }
        }

        async function previewCertificate() {
            const previewSection = document.getElementById('preview-section');
            const hackathonId = document.getElementById('hackathonId').value;
            
            previewSection.innerHTML = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...';
            
            try {
                let imageUrl = '/row-certificat.png';
                
                if (hackathonId) {
                    const response = await fetch(`${baseUrl}/api/admin/hackathons/${hackathonId}/certificate-template?t=${Date.now()}`, {
                        credentials: 'include'
                    });
                    if (response.ok) {
                        const data = await response.json();
                        if (data.templatePath) {
                            imageUrl = data.templatePath;
                        }
                    }
                }
                
                previewSection.innerHTML = `
                    <h4>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©:</h4>
                    <img src="${baseUrl}${imageUrl}?t=${Date.now()}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©" onerror="this.src='${baseUrl}/row-certificat.png'">
                    <p>Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø©: ${imageUrl}</p>
                `;
            } catch (error) {
                previewSection.innerHTML = `<p class="error">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©: ${error.message}</p>`;
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            setTimeout(login, 1000);
        };
    </script>
</body>
</html>
