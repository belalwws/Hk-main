# ๐ง ุฅุตูุงุญ ูุดุงูู ุชุณุฌูู ุงูุฏุฎูู - ููุฎุต ุงูุชุญุฏูุซุงุช

## ๐ ุงููุดุงูู ุงูุฃุตููุฉ
1. **ุฎุทุฃ 500 ูู API verify-session** - ูุดู ูู ุงูุชุญูู ูู ุงูุฌูุณุฉ
2. **ุฎุทุฃ 429 ูู API login** - ุชุฌุงูุฒ ุญุฏ ุงููุญุงููุงุช (Rate Limiting)
3. **ุนุฏู ูุฏุฑุฉ ุงููุญูููู ุนูู ุชุณุฌูู ุงูุฏุฎูู**
4. **ุฑุณุงูุฉ "ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ" ุญุชู ูุน ุงูุจูุงูุงุช ุงูุตุญูุญุฉ**

## โ ุงูุญููู ุงููุทุจูุฉ

### 1. ุฅุตูุงุญ Rate Limiting
**ุงูููู:** `lib/rate-limit.ts`
- ุฅุถุงูุฉ console.log ูุชุชุจุน ุญุงูุฉ Rate Limiting
- ุชุฃููุฏ ุชุนุทูู Rate Limiting ูู Development
- ุฅุถุงูุฉ ุฏูุงู `resetRateLimit()` ู `clearAllRateLimits()` ููุชุญูู

**ุงูููู ุงูุฌุฏูุฏ:** `app/api/debug/reset-rate-limit/route.ts`
- API endpoint ูุฅุนุงุฏุฉ ุชุนููู Rate Limits ูู Development
- ูุฏุนู ุฅุนุงุฏุฉ ุชุนููู IP ูุญุฏุฏ ุฃู ูุณุญ ุฌููุน ุงููููุฏ
- ูุชุงุญ ููุท ูู ุจูุฆุฉ Development

### 2. ุฅุตูุงุญ API verify-session
**ุงูููู:** `app/api/verify-session/route.ts`
- ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุถุงูุฉ ุฏุนู ูููุณุชุฎุฏููู ุงูุฎุงุตูู (Dev Admin)
- ุฅุถุงูุฉ ุฏุนู ูููุณุชุฎุฏููู ุงููุจูููู ุนูู ุงููููุงุช
- ูุนุงูุฌุฉ ุฃูุถู ููุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ

### 3. ุชุญุณูู ุชุชุจุน ุงูุฃุฎุทุงุก
- ุฅุถุงูุฉ console.log ููุตู ูู ุฌููุน APIs
- ุชุชุจุน ุฃูุถู ูุญุงูุงุช ุงููุดู ูุงููุฌุงุญ
- ูุนูููุงุช ุชุดุฎูุตูุฉ ุฃูุซุฑ ุชูุตููุงู

## ๐ง ุงููููุงุช ุงููุญุฏุซุฉ

### 1. `lib/rate-limit.ts`
```typescript
// ุฅุถุงูุฉ ุชุชุจุน ุฃูุถู
console.log('๐ Rate limit check - NODE_ENV:', process.env.NODE_ENV)

// ุฅุถุงูุฉ ุฏูุงู ุฌุฏูุฏุฉ
export function resetRateLimit(request: NextRequest, path?: string)
export function clearAllRateLimits()
```

### 2. `app/api/verify-session/route.ts`
```typescript
// ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก
try {
  user = await prismaClient.user.findUnique(...)
} catch (dbError) {
  console.error('โ Database query failed:', dbError)
  user = null
}

// ุฏุนู Dev Admin
if (payload.userId === 'dev-admin' && payload.email === DEV_ADMIN_EMAIL) {
  return NextResponse.json({ user: devAdminUser })
}

// ุฏุนู ุงููุณุชุฎุฏููู ุงููุจูููู ุนูู ุงููููุงุช
const fileUser = participants.find(p => p.id === payload.userId)
```

### 3. `app/api/debug/reset-rate-limit/route.ts` (ุฌุฏูุฏ)
```typescript
// API ูุฅุนุงุฏุฉ ุชุนููู Rate Limits
POST /api/debug/reset-rate-limit
- { "action": "clear-all" } - ูุณุญ ุฌููุน ุงููููุฏ
- { "action": "reset-ip", "path": "/api/login" } - ุฅุนุงุฏุฉ ุชุนููู IP ูุญุฏุฏ
```

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงุณุชุฎุฏุงู ููู ุงูุงุฎุชุจุงุฑ
ุงูุชุญ `test-login-fix.html` ูู ุงููุชุตูุญ ูุงุชุจุน ุงูุฎุทูุงุช:

1. **ุฅุนุงุฏุฉ ุชุนููู Rate Limits** - ุงุถุบุท "ุฅุนุงุฏุฉ ุชุนููู ุฌููุน Rate Limits"
2. **ุงุฎุชุจุงุฑ APIs** - ุชุญูู ูู ุนูู verify-session ู auth/verify
3. **ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู** - ุฌุฑุจ ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจุงุช ูุฎุชููุฉ
4. **ุงุฎุชุจุงุฑ ุงููุญูููู** - ุฃูุดุฆ ุญุณุงุจ ูุญูู ูุงุฎุชุจุฑ ุชุณุฌูู ุงูุฏุฎูู

### 2. ุงุฎุชุจุงุฑ ูุฏูู
```bash
# ุฅุนุงุฏุฉ ุชุนููู Rate Limits
curl -X POST http://localhost:3000/api/debug/reset-rate-limit \
  -H "Content-Type: application/json" \
  -d '{"action": "clear-all"}'

# ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@hackathon.gov.sa", "password": "admin123"}'
```

## ๐ฏ ุงูุญุณุงุจุงุช ุงููุชุงุญุฉ ููุงุฎุชุจุงุฑ

### 1. ุญุณุงุจ ุงููุฏูุฑ ุงูุงูุชุฑุงุถู
- **ุงูุจุฑูุฏ:** `admin@hackathon.gov.sa`
- **ูููุฉ ุงููุฑูุฑ:** `admin123`
- **ุงูุฏูุฑ:** admin

### 2. ุฅูุดุงุก ุญุณุงุจ ูุญูู ุฌุฏูุฏ
ุงุณุชุฎุฏู API ุฅูุดุงุก ุงููุญูููู ุฃู ููู ุงูุงุฎุชุจุงุฑ ูุฅูุดุงุก ุญุณุงุจ ูุญูู ุฌุฏูุฏ.

## ๐จ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ููุช ุชูุงุฌู ุฎุทุฃ 429:
1. ุงูุชุญ `test-login-fix.html`
2. ุงุถุบุท "ุฅุนุงุฏุฉ ุชุนููู ุฌููุน Rate Limits"
3. ุฌุฑุจ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู

### ุฅุฐุง ููุช ุชูุงุฌู ุฎุทุฃ 500:
1. ุชุญูู ูู console logs ูู ุงููุชุตูุญ
2. ุชุญูู ูู server logs
3. ุงุณุชุฎุฏู `/api/debug/jwt` ููุชุญูู ูู JWT
4. ุงุณุชุฎุฏู `/api/verify-session` ููุชุญูู ูู ุงูุฌูุณุฉ

### ุฅุฐุง ูุงูุช "ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ":
1. ุชุฃูุฏ ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ
2. ุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุฌุฑุจ ุญุณุงุจ ุงููุฏูุฑ ุงูุงูุชุฑุงุถู ุฃููุงู

## ๐ APIs ุงููุญุฏุซุฉ

### 1. `/api/verify-session` - ุงูุชุญูู ูู ุงูุฌูุณุฉ
- โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก
- โ ุฏุนู Dev Admin
- โ ุฏุนู ุงููุณุชุฎุฏููู ุงููุจูููู ุนูู ุงููููุงุช

### 2. `/api/auth/login` - ุชุณุฌูู ุงูุฏุฎูู
- โ Rate Limiting ูุญุณู
- โ ุชุชุจุน ุฃูุถู ููุฃุฎุทุงุก

### 3. `/api/debug/reset-rate-limit` - ุฅุนุงุฏุฉ ุชุนููู Rate Limits (ุฌุฏูุฏ)
- โ ูุณุญ ุฌููุน ุงููููุฏ
- โ ุฅุนุงุฏุฉ ุชุนููู IP ูุญุฏุฏ
- โ ูุชุงุญ ูู Development ููุท

## โจ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุงูุขู ุชุณุฌูู ุงูุฏุฎูู ูุนูู ุจุดูู ุตุญูุญ:
- โ ูุง ุชูุฌุฏ ูุดุงูู Rate Limiting ูู Development
- โ verify-session API ูุนูู ุจุฏูู ุฃุฎุทุงุก 500
- โ ูููู ูููุฏุฑุงุก ุชุณุฌูู ุงูุฏุฎูู
- โ ูููู ูููุญูููู ุชุณุฌูู ุงูุฏุฎูู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ
- โ ุฃุฏูุงุช ุชุดุฎูุต ูุชูุฏูุฉ

## ๐ ุฎุทูุงุช ูุง ุจุนุฏ ุงูุชุทุจูู

1. ุงุฎุชุจุฑ ุชุณุฌูู ุงูุฏุฎูู ูุน ุญุณุงุจุงุช ูุฎุชููุฉ
2. ุชุฃูุฏ ูู ุนูู ุฌููุน ุงูุฃุฏูุงุฑ (admin, judge, participant)
3. ุงุฎุชุจุฑ ุนูู ุจูุฆุงุช ูุฎุชููุฉ (development, production)
4. ุฑุงูุจ server logs ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ุฌุฏูุฏุฉ
